---
version: 3

# เลือก Base Image
images:
  base_image:
    name: registry.redhat.io/ansible-automation-platform-25/ee-minimal-rhel9:latest

# Dependencies
dependencies:
  ansible_core:
    package_pip: ansible-core==2.16.7 # ระบุเวอร์ชันที่แน่นอน
  ansible_runner:
    package_pip: ansible-runner==2.3.6
  galaxy: requirements.yml          # Ansible Collections
  python: requirements.txt          # Python packages
  system: bindep.txt               # System packages (optional)

# Additional build steps (ถ้าต้องการ)
additional_build_steps:
  prepend_base:
    - RUN whoami
    - RUN cat /etc/os-release
    - RUN echo "Installing pip and other build essentials"
    - RUN microdnf install -y python3-pip && microdnf clean all
    - RUN echo "Building Cisco NX-OS Execution Environment"
  
  append_final:
    - RUN echo "Build completed"
    - RUN ansible-galaxy collection list

# Build arguments
build_arg_defaults:
  ANSIBLE_GALAXY_CLI_COLLECTION_OPTS: '--pre'